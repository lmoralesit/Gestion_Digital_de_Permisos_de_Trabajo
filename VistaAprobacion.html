<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"><title>Aprobación Final</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
  <style>canvas{width:100%; height:120px; border:2px dashed #0d6efd; border-radius:8px;}</style>
</head>
<body class="bg-light"><div class="container mt-4" style="max-width: 800px;">
  <div class="card shadow border-primary"><div class="card-body p-4">
    <h4 class="text-primary border-bottom pb-2">Módulo 5: Aprobación</h4>
    <input type="hidden" id="tk" value="<?= token ?>">
    <div id="load" class="text-center py-4"><div class="spinner-border"></div></div>
    <div id="cont" class="d-none">
      <div class="alert alert-secondary" id="info"></div>
      <label class="fw-bold text-primary mt-2">1. Firma Solicitante</label><canvas id="p1"></canvas>
      <label class="fw-bold text-success mt-2">2. Firma Dueño Área</label><canvas id="p2"></canvas>
      <label class="fw-bold text-danger mt-2">3. Firma Analista SSA</label><canvas id="p3"></canvas>
      <button class="btn btn-primary btn-lg w-100 mt-4" onclick="aprobar()">Aprobar y Generar PDF</button>
    </div>
  </div></div>
</div>
<script>
  let s1,s2,s3;
  window.onload=()=>{
    s1=new SignaturePad(document.getElementById('p1')); s2=new SignaturePad(document.getElementById('p2')); s3=new SignaturePad(document.getElementById('p3'));
    google.script.run.withSuccessHandler(r=>{ document.getElementById('load').classList.add('d-none'); document.getElementById('cont').classList.remove('d-none'); document.getElementById('info').innerHTML=`<b>${r.pt}</b> - ${r.area}`; }).obtenerDatosAprobacion(document.getElementById('tk').value);
  }
  function aprobar(){
    document.querySelector('.btn-primary').innerText="Generando PDF y Activando...";
    google.script.run.withSuccessHandler(r=>document.getElementById('cont').innerHTML="<div class='alert alert-success'>Permiso Activo y PDF guardado en Drive.</div>").guardarAprobacion(document.getElementById('tk').value, s1.toDataURL(), s2.toDataURL(), s3.toDataURL());
  }
</script></body></html>